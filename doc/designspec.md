# ローカルLLM PDF要約システム設計仕様書

## 目的

- 低スペックGPUまたはCPUのみの環境で動作可能なローカルLLMを用い、PDFドキュメントの要約を生成する。

## 機能要件

- PDFファイル、html、あるいはそれらへのリンクを入力として受け付ける
- テキスト抽出・前処理（日本語・英語対応）
- ローカルLLMによる要約生成
- 要約結果の保存（txt, md, json等）
- エラーハンドリング（ファイル不正・抽出失敗・モデルエラー等）
- コマンドライン/GUIインターフェース（CLI優先）

## 非機能要件

- 低メモリ・低GPU/CPUリソースで動作
- オープンソースLLM（例：llama.cpp, GPT4All, SentenceTransformer等）を活用
- セキュリティ・プライバシー重視（外部送信なし）
- 再現性・保守性を意識した設計
- PEP8準拠・十分なコメント・ドキュメント整備
- テストコードによる品質担保

## 具体的な性能目標

### ハードウェア要件

- **最小メモリ**: 4GB RAM（CPU推論時）
- **推奨メモリ**: 8GB RAM（GPU推論時）
- **GPU要件**: VRAM 4GB以上（オプション）
- **ストレージ**: 5GB以上（モデルファイル含む）

### 処理性能目標

- **小規模PDF**（1-10ページ）: 3分以内
- **中規模PDF**（11-50ページ）: 10分以内
- **大規模PDF**（51-100ページ）: 30分以内
- **要約精度**: ROUGE-Lスコア 0.3以上
- **メモリ使用量**: 処理中8GB以下を維持

## システム構成

- PDF抽出モジュール（PyPDF2, pdfminer.six等）
- HTML抽出モジュール（BeautifulSoup4, requests等）
- 前処理モジュール（テキストクリーニング・分割・正規化）
- LLM要約モジュール（ローカル推論・モデル選択可）
- 結果保存モジュール
- CLIインターフェース

## 主要技術・ライブラリ

- Python 3.10以降
- PyPDF2 / pdfminer.six（PDFテキスト抽出）
- BeautifulSoup4 / lxml（HTML解析・テキスト抽出）
- requests / aiohttp（Web取得）
- html2text（HTML→テキスト変換）
- llama-cpp-python / GPT4All / SentenceTransformer（LLM推論）
- argparse / click（CLI構築）
- pytest（テスト）
- Docker（開発環境構築・配布）

## 段階的開発計画

### Phase 1: MVP（最小実用製品）

- シンプルなPDF抽出機能
- 基本的なテキスト前処理
- llama.cppベースの要約生成
- CLIインターフェース
- **目標期間**: 4-6週間

### Phase 2: 機能拡張

- GPU対応・性能最適化
- 複数LLMモデル対応
- HTML・URL入力対応
- 要約品質向上
- **目標期間**: 6-8週間

### Phase 3: 品質向上・UI改善

- GUIインターフェース追加
- 詳細な設定オプション
- バッチ処理機能
- 詳細なログ・エラー報告
- **目標期間**: 4-6週間

## セキュリティ・運用指針

- 入力ファイルの検証・サニタイズ
- モデル・ライブラリの脆弱性管理
- ユーザーデータの外部送信禁止
- ライセンス遵守

## ベンチマークテスト計画

### 性能テスト

- **処理時間測定**: 各サイズ・種類のPDFでの実行時間
- **メモリ使用量監視**: プロファイリングツール（memory_profiler等）使用
- **CPU/GPU使用率**: システムリソース監視
- **スループット測定**: 複数ファイル同時処理時の性能

### 品質テスト

- **要約精度評価**: ROUGE-L, BLEU, BERTScoreによる自動評価
- **人手評価**: 一定数のサンプルでの主観評価（関連性・簡潔性・流暢性）
- **多言語対応**: 日本語・英語・混在文書での品質比較
- **文書種別対応**: 論文・報告書・技術文書等での品質測定

### 回帰テスト

- **単体テスト**: 各モジュール機能の自動テスト
- **統合テスト**: エンドツーエンドの動作確認
- **エラーケーステスト**: 不正入力・メモリ不足等の異常系テスト

## ユーザーフィードバック収集方法

### フィードバック収集チャネル

- **GitHub Issues**: バグ報告・機能要望の受付
- **アンケート調査**: 定期的なユーザー満足度調査
- **ユーザーインタビュー**: 深掘りインタビュー（月1回程度）
- **ログ分析**: 使用パターン・エラー頻度の分析

### 評価指標

- **機能満足度**: 5段階評価（使いやすさ・速度・精度）
- **要望優先度**: 新機能への需要調査
- **継続利用意向**: NPS（Net Promoter Score）測定
- **技術的課題**: エラー頻度・処理失敗率

### フィードバック活用プロセス

- **週次レビュー**: 収集したフィードバックの分析・優先順位付け
- **月次計画**: 改善項目の開発計画への反映
- **ユーザー報告**: 改善内容のユーザーへのフィードバック

## 拡張性・保守性

- モジュール分割による機能追加容易化
- 設定ファイルによるモデル・パラメータ切替
- ドキュメント・テストの充実

## 参考運用フロー

1. 入力ファイル指定（PDF、HTML、URL）
2. 形式判定・テキスト抽出・前処理
3. LLMによる要約生成
4. 結果保存・出力

### HTML対応の詳細仕様

- **対応形式**: ローカル.htmlファイル、WebページURL、HTMLコンテンツ直接入力
- **前処理**: HTMLタグ除去、JavaScript/CSS除去、文字エンコーディング自動判定
- **構造保持**: 見出し・段落・リスト構造の維持
- **エラーハンドリング**: ネットワークエラー・無効HTML・アクセス拒否への対応

## その他

- ユーザー・チームからのフィードバックを反映し、継続的に改善
- 技術知見はMarkdownで共有
